<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/public/css/index.css">
    <title>Чат</title>
</head>

<body>
    <!-- форма для отправки сообщений -->
    <form name="publish">
        <input type="hidden" name="roomId" value="{{#if roomId}}{{roomId}}{{else}}0{{/if}}">
        <div>Ник:</div>
        <textarea name="nick" id="nick-area" required></textarea>

        <div>Ключ шифрования:</div>
        <textarea name="key" id="key-area"></textarea>

        <a onclick="toggleMenuVisibility()" id="menu-toggle-link">Показать меню</a>
        <div id="menu" style="display: none;">
            <label><input type="checkbox" id="save-key-checkbox">Сохранить ключ в LocalStorage</label>
            <button id="delete-key-button" onclick="removeKeyFromLocalStorage()" type="button">Удалить ключ из LocalStorage</button>
            <button id="apply-key-button" onclick="decryptMessages()" type="button">Расшифровать сообщения</button> <!--Do not remove type="button", it will cause message to be sent together with decryption!-->
            <button id="decrypt-keys-button" onclick="decryptKeys()" type="button">Расшифровать ключи из LocalStorage</button>
            <button id="set-password-button" onclick="setPassword()" type="button">Установить пароль</button>
            <button id="remove-password-button" onclick="if (confirm('Вы точно хотите удалить сохраненный пароль?')) sessionStorage.passwordHash = ''" type="button">Удалить пароль</button>
        </div>

        <div>Сообщение:</div>
        <textarea name="message" id="message-area" required></textarea>

        <input type="file" id="files" name="files[]" multiple="true">
        <button type="submit" id="message-submit-button">Отправить</button>
    </form>
    
    <!-- здесь будут появляться входящие сообщения -->
    <div id="subscribe">
        <div id="subscribe-empty-reminder" v-if="!messageList.length && showEmptySubscribeFeedMessage">Здесь будут появляться новые сообщения. Пока что тут ничего нет.</div>
        <div id="reply-list-div" v-if="this.replyList.length">В этом сообщении вы отвечаете на: { replyList.join(', ') } <a v-on:click="clearReplyList()">Отменить</a> </div>
        <div v-for="item in messageList" v-html="item.html" class="message"></div>
    </div>

    <script src="https://unpkg.com/vue@next"></script>
    <script src="/public/vue-app.js"></script>
    <script src="/public/cryptojs/aes.js"></script>
    <script src="/public/cryptojs/sha256.js"></script>
    <script src="/public/browser.js"></script>
</body>